<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PIXELS FIGHTING</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f0f0;
      text-align: center;
      margin: 0; padding: 20px;
    }
    #controls {
      margin: 10px 0;
    }
    #stats {
      margin: 10px 0;
      font-size: 1.1em;
    }
    canvas {
      border: 1px solid #333;
      background: #fff;
    }
    button, input[type=range] {
      cursor: pointer;
    }
  </style>
</head>
<body onload="setup()">

  <h1>PIXELS FIGHTING</h1>
  <div id="controls">
    <button id="toggle">Pause</button>
    <label>
      Speed: <input id="speed" type="range" min="1" max="100" value="20">
    </label>
    <button onclick="reset()">Reset</button>
  </div>
  <div id="stats">Team A: 50.0% | Team B: 50.0%</div>
  <canvas id="scrawl" width="500" height="500"></canvas>

  <script>
    // core variables
    let canvas, ctx, interval;
    let width = 500, height = 500;
    const size = 125, step = width / size;
    let Old, New, Neigh, Ratio1;
    let speed = 20;
    let running = true;

    // team colors
    const colorA = '#0074D9';  // blue
    const colorB = '#FF4136';  // red

    function setup() {
      canvas = document.getElementById("scrawl");
      ctx = canvas.getContext("2d");

      // build arrays
      Old = Array.from({length: size}, () => Array(size).fill(0));
      New = Array.from({length: size}, () => Array(size).fill(0));
      Neigh = Array.from({length: size}, () => Array(size).fill(8));
      Ratio1 = Array.from({length: size}, () => Array(size).fill(0));

      // neighbor counts for edges
      for (let i = 0; i < size; i++) {
        for (let j = 0; j < size; j++) {
          let count = 8;
          if (i === 0 || i === size - 1) count -= 3;
          if (j === 0 || j === size - 1) count -= 3;
          Neigh[i][j] = count;
        }
      }

      // initial split: top half Team A (1), bottom half Team B (2)
      for (let i = 0; i < size; i++) {
        for (let j = 0; j < size; j++) {
          Old[i][j] = (i < size/2 ? 1 : 2);
        }
      }

      // controls
      document.getElementById('toggle').onclick = toggleRunning;
      document.getElementById('speed').oninput = e => {
        speed = parseInt(e.target.value);
        restartInterval();
      };

      // start simulation
      restartInterval();
    }

    function restartInterval() {
      clearInterval(interval);
      if (running) interval = setInterval(run, speed);
    }

    function toggleRunning() {
      running = !running;
      document.getElementById('toggle').textContent = running ? 'Pause' : 'Resume';
      restartInterval();
    }

    function reset() {
      // re-initialize teams
      for (let i = 0; i < size; i++) {
        for (let j = 0; j < size; j++) {
          Old[i][j] = (i < size/2 ? 1 : 2);
        }
      }
    }

    // compute neighbor ratios for Team A
    function computeRatios() {
      for (let i = 0; i < size; i++) {
        for (let j = 0; j < size; j++) {
          let countA = 0;
          for (let di = -1; di <= 1; di++) {
            for (let dj = -1; dj <= 1; dj++) {
              if (di === 0 && dj === 0) continue;
              let ni = i + di, nj = j + dj;
              if (ni >= 0 && ni < size && nj >= 0 && nj < size) {
                if (Old[ni][nj] === 1) countA++;
              }
            }
          }
          Ratio1[i][j] = countA / Neigh[i][j];
        }
      }
    }

    // draw current state
    function draw() {
      for (let i = 0; i < size; i++) {
        for (let j = 0; j < size; j++) {
          ctx.fillStyle = (Old[i][j] === 1 ? colorA : colorB);
          ctx.fillRect(i * step, j * step, step, step);
        }
      }
    }

    // update cells: each cell adopts the majority neighbor team
    function update() {
      for (let i = 0; i < size; i++) {
        for (let j = 0; j < size; j++) {
          let r1 = Ratio1[i][j];
          let r2 = 1 - r1;
          New[i][j] = (r1 > r2 ? 1 : 2);
        }
      }
      // swap buffers
      [Old, New] = [New, Old];
    }

    // calculate and display stats
    function updateStats() {
      let countA = 0;
      for (let i = 0; i < size; i++) {
        for (let j = 0; j < size; j++) {
          if (Old[i][j] === 1) countA++;
        }
      }
      const total = size * size;
      const ratioA = countA / total;
      const ratioB = 1 - ratioA;
      document.getElementById('stats').textContent =
        `Team A: ${(ratioA*100).toFixed(1)}% | Team B: ${(ratioB*100).toFixed(1)}%`;
    }

    function run() {
      computeRatios();
      draw();
      update();
      updateStats();
    }
  </script>

</body>
</html>
