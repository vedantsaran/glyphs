<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mini Republics</title>
  <style>
    /* ─────── Global Reset & Base Styles ─────── */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      background: #f4f4f4;
      color: #333;
      font-family: "Segoe UI", sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
    }
    button {
      font-family: inherit;
      font-size: 1rem;
      padding: 10px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.2s, transform 0.1s;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    button:not(:disabled):hover {
      transform: translateY(-2px);
    }

    /* ─────── Container ─────── */
    #game-container {
      width: 100%;
      max-width: 600px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    /* ─────── Header ─────── */
    header {
      background: #2e8b57;
      color: #fff;
      padding: 16px 24px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    header h1 {
      font-size: 1.5rem;
    }
    #stats {
      display: flex;
      gap: 12px;
      font-size: 0.95rem;
    }
    #stats div {
      background: rgba(255, 255, 255, 0.15);
      padding: 6px 10px;
      border-radius: 4px;
    }

    /* ─────── Main Content ─────── */
    main {
      padding: 24px;
    }
    #week-display {
      font-size: 1.1rem;
      margin-bottom: 16px;
      text-align: center;
      color: #2e8b57;
    }
    #decision-prompt {
      margin-bottom: 16px;
      font-size: 1.2rem;
    }
    #choices {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 24px;
    }
    .choice-btn {
      background: #2e8b57;
      color: #fff;
    }
    .choice-btn:hover {
      background: #3aa76e;
    }
    #outcome {
      margin-bottom: 24px;
      font-size: 1rem;
      line-height: 1.4;
    }
    #next-btn {
      background: #2e8b57;
      color: #fff;
      display: block;
      margin: 0 auto;
    }

    /* ─────── Footer ─────── */
    footer {
      background: #fafafa;
      text-align: center;
      font-size: 0.85rem;
      padding: 12px;
      color: #666;
    }

    /* ─────── Responsive ─────── */
    @media (max-width: 480px) {
      header {
        flex-direction: column;
        gap: 8px;
      }
      #stats {
        flex-wrap: wrap;
        justify-content: center;
      }
      main {
        padding: 16px;
      }
      .choice-btn {
        font-size: 0.9rem;
        padding: 8px 12px;
      }
    }
  </style>
</head>
<body>
  <div id="game-container">
    <!-- HEADER: Republic Name & Key Stats -->
    <header>
      <h1>Mini Republics</h1>
      <div id="stats">
        <div>Treasury: $<span id="stat-treasury">-</span> M</div>
        <div>Population: <span id="stat-pop">-</span> K</div>
        <div>Approval %: <span id="stat-approval">-</span>%</div>
        <div>Relations: A <sup><span id="stat-rel-A">-</span></sup> | B <sup><span id="stat-rel-B">-</span></sup></div>
      </div>
    </header>

    <!-- MAIN: Weekly Prompt, Choices, Outcome, Next -->
    <main>
      <div id="week-display">Week 1, Year 1</div>
      <div id="decision-prompt">Loading...</div>
      <div id="choices"></div>
      <div id="outcome"></div>
      <button id="next-btn" disabled>Next Week</button>
    </main>

    <!-- FOOTER: Credits -->
    <footer>© Mini Republics • Built with JavaScript</footer>
  </div>

  <script>
    /******************************************************
     *   Mini Republics – Full Implementation in One File  *
     ******************************************************/

    // ─────── Game State ───────
    const state = {
      week: 1,
      year: 1,
      treasury: 50,            // in millions
      population: 100,         // in thousands
      approval: 50,            // percentage (0–100)
      relations: {             // relations with two neighbors
        Alpha: 50,             // 0–100 scale
        Beta: 50
      }
    };

    // ─────── Decision Pool ───────
    // Each decision has a prompt and two or three choices.  
    // Each choice applies some function that mutates `state`.
    const decisions = [
      {
        category: "Economy",
        prompt: "Your advisors propose lowering income tax rates to stimulate growth. What do you do?",
        choices: [
          {
            text: "Reduce taxes by 2%",
            effect: () => {
              state.treasury = Math.max(0, state.treasury - 5);
              state.approval = Math.min(100, state.approval + 5);
              appendOutcome("Taxes lowered. Short‐term revenue drops, but public morale rises.");
            }
          },
          {
            text: "Keep taxes unchanged",
            effect: () => {
              state.approval = Math.max(0, state.approval - 1);
              appendOutcome("No change. People expected relief, so approval dips slightly.");
            }
          },
          {
            text: "Increase taxes by 2%",
            effect: () => {
              state.treasury += 6;
              state.approval = Math.max(0, state.approval - 7);
              appendOutcome("Taxes increased. Treasury benefits, but public is unhappy.");
            }
          }
        ]
      },
      {
        category: "Infrastructure",
        prompt: "Build a new coastal road to improve trade access. This costs money now but may boost growth later.",
        choices: [
          {
            text: "Authorize construction (−$12 M)",
            effect: () => {
              state.treasury = Math.max(0, state.treasury - 12);
              state.approval = Math.min(100, state.approval + 3);
              appendOutcome("Road construction begins. Approval rises for improved infrastructure.");
            }
          },
          {
            text: "Delay project",
            effect: () => {
              state.approval = Math.max(0, state.approval - 2);
              appendOutcome("Project delayed due to budget concerns. Small drop in approval.");
            }
          }
        ]
      },
      {
        category: "Social",
        prompt: "Healthcare is stretched. Your health minister suggests increasing funding. Choose an option:",
        choices: [
          {
            text: "Allocate +$8 M to healthcare",
            effect: () => {
              state.treasury = Math.max(0, state.treasury - 8);
              state.approval = Math.min(100, state.approval + 7);
              state.population += 1;  // slight population growth due to better health
              appendOutcome("Healthcare funded generously. Approval soars, population health improves.");
            }
          },
          {
            text: "Maintain current funding",
            effect: () => {
              appendOutcome("No change. Public remains cautious but sees no harm.");
            }
          },
          {
            text: "Cut healthcare budget by $5 M",
            effect: () => {
              state.treasury += 5;
              state.approval = Math.max(0, state.approval - 8);
              state.population = Math.max(0, state.population - 1);
              appendOutcome("Healthcare budget cut. Approval plunges, some public health declines.");
            }
          }
        ]
      },
      {
        category: "Diplomacy",
        prompt: "Neighbor Alpha requests a trade deal: they offer resources if we lower export tariffs. What’s your decision?",
        choices: [
          {
            text: "Agree to trade deal",
            effect: () => {
              state.relations.Alpha = Math.min(100, state.relations.Alpha + 10);
              state.treasury += 4;
              appendOutcome("Trade deal approved. Alpha relations improve, small treasury gain.");
            }
          },
          {
            text: "Decline politely",
            effect: () => {
              state.relations.Alpha = Math.max(0, state.relations.Alpha - 5);
              appendOutcome("Trade deal refused. Relations with Alpha suffer slightly.");
            }
          }
        ]
      },
      {
        category: "Diplomacy",
        prompt: "Neighbor Beta is holding joint military exercises. Some fear they’re a provocation. Do you respond?",
        choices: [
          {
            text: "Send a diplomatic envoy",
            effect: () => {
              state.relations.Beta = Math.min(100, state.relations.Beta + 8);
              state.treasury = Math.max(0, state.treasury - 2);
              appendOutcome("Envoy sent. Beta pleased, relations improve; a small diplomatic expense.");
            }
          },
          {
            text: "Issue a formal protest",
            effect: () => {
              state.relations.Beta = Math.max(0, state.relations.Beta - 7);
              state.approval = Math.max(0, state.approval - 3);
              appendOutcome("Formal protest issued. Public approval dips as tensions rise.");
            }
          }
        ]
      },
      {
        category: "Environment",
        prompt: "A proposal emerges to subsidize solar panel installations for households. Choose an action:",
        choices: [
          {
            text: "Subsidize 50% of cost (−$7 M)",
            effect: () => {
              state.treasury = Math.max(0, state.treasury - 7);
              state.approval = Math.min(100, state.approval + 6);
              appendOutcome("Solar subsidy enacted. Approval rises among green‐minded citizens.");
            }
          },
          {
            text: "Reject subsidy idea",
            effect: () => {
              state.approval = Math.max(0, state.approval - 4);
              appendOutcome("Subsidy rejected. Environmental activists disappointed.");
            }
          }
        ]
      }
      // (You can add more decision objects to increase variety.)
    ];

    // ─────── Random Events Pool ───────
    // After each decision, one random event may occur.
    const events = [
      {
        description: "A mild hurricane hits the coast. Some infrastructure is damaged.",
        effect: () => {
          state.treasury = Math.max(0, state.treasury - 10);
          state.approval = Math.max(0, state.approval - 8);
          state.population = Math.max(0, state.population - 2);
          return "Hurricane damages roads and homes. Expenses rise, approval falls.";
        }
      },
      {
        description: "A sudden tourism boom brings extra revenue.",
        effect: () => {
          state.treasury += 8;
          state.approval = Math.min(100, state.approval + 4);
          return "Tourism surge: treasury gains, slight approval boost.";
        }
      },
      {
        description: "Crop disease reduces agricultural output.",
        effect: () => {
          state.treasury = Math.max(0, state.treasury - 6);
          state.population = Math.max(0, state.population - 1);
          state.approval = Math.max(0, state.approval - 5);
          return "Crop disease hits farms. Economy shrinks, some population decline.";
        }
      },
      {
        description: "Neighbor Alpha holds goodwill festival and shares gifts.",
        effect: () => {
          state.relations.Alpha = Math.min(100, state.relations.Alpha + 10);
          state.approval = Math.min(100, state.approval + 3);
          return "Alpha’s festival warms relations. All rejoice.";
        }
      },
      {
        description: "A tech startup in your republic patents a new process. Investors flock.",
        effect: () => {
          state.treasury += 5;
          state.approval = Math.min(100, state.approval + 6);
          state.population += 1;
          return "Innovation breakthrough! Economy and approval rise.";
        }
      },
      {
        description: "Minor protest erupts over unemployment.",
        effect: () => {
          state.approval = Math.max(0, state.approval - 7);
          return "Protest forms in capital. Approval drops.";
        }
      }
      // (Add more events to keep things unpredictable.)
    ];

    // ─────── DOM References ───────
    const statTreasuryEl   = document.getElementById("stat-treasury");
    const statPopEl        = document.getElementById("stat-pop");
    const statApprovalEl   = document.getElementById("stat-approval");
    const statRelAEl       = document.getElementById("stat-rel-A");
    const statRelBEl       = document.getElementById("stat-rel-B");
    const weekDisplayEl    = document.getElementById("week-display");
    const promptEl         = document.getElementById("decision-prompt");
    const choicesEl        = document.getElementById("choices");
    const outcomeEl        = document.getElementById("outcome");
    const nextBtn          = document.getElementById("next-btn");

    // ─────── Utility: Update All Stats on Screen ───────
    function renderStats() {
      statTreasuryEl.textContent = state.treasury.toFixed(1);
      statPopEl.textContent      = state.population.toFixed(1);
      statApprovalEl.textContent = state.approval.toFixed(0);
      statRelAEl.textContent     = state.relations.Alpha.toFixed(0);
      statRelBEl.textContent     = state.relations.Beta.toFixed(0);
      weekDisplayEl.textContent  = `Week ${state.week}, Year ${state.year}`;
    }

    // ─────── Utility: Clear Outcome & Choices ───────
    function clearOutcomeAndChoices() {
      outcomeEl.textContent = "";
      choicesEl.innerHTML = "";
    }

    // ─────── Utility: Append a Line to Outcome Area ───────
    function appendOutcome(text) {
      const p = document.createElement("p");
      p.textContent = text;
      outcomeEl.appendChild(p);
    }

    // ─────── Choose a Random Decision That’s Not the Same Category Twice ───────
    let lastCategory = null;
    function pickDecision() {
      // Filter out decisions of the same category as last time, if possible
      let pool = decisions.filter(d => d.category !== lastCategory);
      if (!pool.length) pool = decisions.slice(); // fallback if none left
      const idx = Math.floor(Math.random() * pool.length);
      lastCategory = pool[idx].category;
      return pool[idx];
    }

    // ─────── Render the Choices for a Given Decision ───────
    function renderDecision(decision) {
      promptEl.textContent = decision.prompt;
      choicesEl.innerHTML = "";
      outcomeEl.textContent = "";
      nextBtn.disabled = true;

      decision.choices.forEach((choiceObj, i) => {
        const btn = document.createElement("button");
        btn.className = "choice-btn";
        btn.textContent = choiceObj.text;
        btn.addEventListener("click", () => {
          // Disable all choice buttons immediately
          document.querySelectorAll(".choice-btn").forEach(b => b.disabled = true);
          // Apply the chosen effect
          choiceObj.effect();
          // After decision effect, show Proceed button
          nextBtn.disabled = false;
          nextBtn.textContent = "Proceed ▶";
        });
        choicesEl.appendChild(btn);
      });
    }

    // ─────── Apply a Random Event (with ~50% Chance) ───────
    function applyRandomEvent() {
      const trigger = Math.random() < 0.5; // 50% probability
      if (!trigger) return;
      const ev = events[Math.floor(Math.random() * events.length)];
      const resultText = ev.effect();
      appendOutcome("🔔 Event: " + resultText);
    }

    // ─────── Advance to Next Week ───────
    function nextWeek() {
      // 1) Advance week & year if needed
      state.week++;
      if (state.week > 52) {
        state.week = 1;
        state.year++;
      }

      // 2) Apply random event
      applyRandomEvent();

      // 3) Tweak some natural growth/decay
      //    - Slight population growth if approval is high
      if (state.approval > 60 && state.population < 200) {
        state.population = +(state.population + 0.5).toFixed(1);
      }
      //    - Small treasury growth from productive sectors if approval > 50
      if (state.approval > 50) {
        state.treasury = +(state.treasury + 1).toFixed(1);
      }

      // 4) Render updated stats
      renderStats();

      // 5) Pick & render a new decision
      const nextDecision = pickDecision();
      renderDecision(nextDecision);
    }

    // ─────── Initialization ───────
    document.addEventListener("DOMContentLoaded", () => {
      renderStats();
      const firstDecision = pickDecision();
      renderDecision(firstDecision);

      // Next-button always calls nextWeek()
      nextBtn.addEventListener("click", () => {
        clearOutcomeAndChoices();
        nextWeek();
      });
    });
  </script>
</body>
</html>
